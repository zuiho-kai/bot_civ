# Agent人格系统设计 — 辩论详细记录

**日期**：2025-02-14
**议题**：如何定义、存储和注入Agent独立人格
**参与者**：辩论者A、辩论者B、辩论者C、架构师、用户
**流程**：2轮辩论（立场陈述 + 交叉质疑回应 + 投票）→ 架构师建议 → 用户决策

---

## 背景和需求

Agent需要有独立的人格，才能在群聊中表现出不同的性格、兴趣和说话风格。需要设计一套人格定义和存储方案。

核心问题：
1. 人格应该用什么格式定义？
2. 如何存储人格数据？
3. 如何注入到LLM的prompt中？
4. 如何让AI能够生成和修改人格？

---

## 讨论过程

### 第一轮：三方立场陈述

**辩论者A（结构化JSON方案）**：

**核心思路**：使用JSON schema定义人格结构

**方案示例**：
```json
{
  "name": "小明",
  "personality_traits": {
    "openness": 0.8,
    "conscientiousness": 0.6,
    "extraversion": 0.9,
    "agreeableness": 0.7,
    "neuroticism": 0.3
  },
  "interests": ["编程", "音乐", "旅行"],
  "speaking_style": {
    "formality": 0.3,
    "humor": 0.8,
    "emoji_usage": 0.7
  },
  "background": "计算机专业学生，喜欢开源社区"
}
```

**优点**：
- AI可以程序化生成和修改
- 易于版本控制和diff
- 可以做数值化分析（例如：找到性格最互补的Agent配对）

**缺点**：
- 表达力有限，难以捕捉复杂人格
- 需要预定义schema，扩展性受限

---

**辩论者B（纯自然语言方案）**：

**核心思路**：用自然语言描述人格，LLM天然理解

**方案示例**：
```
小明是一个20岁的计算机专业学生，性格开朗外向，喜欢结交新朋友。
他对编程充满热情，经常在开源社区活跃。说话风格轻松幽默，喜欢用emoji。
他有点完美主义，但不会过于焦虑。对新事物充满好奇，喜欢尝试新技术。
```

**优点**：
- LLM天然理解，无需额外解析
- 表达力无上限，可以描述任何细节
- 易于人类阅读和编辑

**缺点**：
- 难以程序化修改（例如："让小明更外向一点"）
- 难以做数值化分析
- 不同LLM理解可能有差异

---

**辩论者C（模板+变量方案）**：

**核心思路**：预定义人格模板，填充变量生成

**方案示例**：
```
模板：学生型人格
变量：
- 专业：计算机
- 年龄：20
- 性格倾向：外向（0.9）
- 兴趣标签：[编程, 音乐, 旅行]
- 说话风格：轻松幽默
```

**优点**：
- 保证质量一致性，避免生成奇怪人格
- 易于批量生成
- 结合了结构化和自然语言的优点

**缺点**：
- 灵活性受限于模板
- 需要维护模板库
- 可能导致人格同质化

---

### 第二轮：交叉质疑与回应

**A质疑B**：
> "纯自然语言如何实现'让小明更外向一点'这种程序化修改？"

**B回应**：
> "可以让LLM读取原始描述，然后生成修改后的描述。LLM完全有能力理解'更外向'的含义。"

---

**B质疑C**：
> "模板方案如何避免人格同质化？如果所有'学生型人格'都很相似怎么办？"

**C回应**：
> "可以设计多层模板，基础模板+细节变量。而且模板可以持续扩展，不是固定的。"

---

**C质疑A**：
> "JSON schema如何表达'有点完美主义但不会过于焦虑'这种微妙的人格特征？"

**A回应**：
> "可以用多个维度组合表达，例如：conscientiousness=0.8, neuroticism=0.3。但确实，某些细节难以用数值表达。"

---

### 第三轮：投票结果

投票：1:1:1 三方各执己见

**但关键发现**：所有人都在向"混合方案"靠拢
- A承认：纯JSON难以表达复杂人格，需要补充自然语言
- B承认：纯自然语言难以程序化修改，需要一些结构化元数据
- C承认：模板可能过于僵硬，需要更多灵活性

---

## 架构师建议

基于三方讨论，架构师提出混合方案：

### 混合方案：自然语言为主 + 结构化JSON元数据辅助

**数据库设计**：
```sql
CREATE TABLE agents (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  persona TEXT NOT NULL,  -- 自然语言人格描述
  persona_config JSON,     -- 结构化元数据
  created_at TIMESTAMP
);
```

**persona字段（Text）**：
```
小明是一个20岁的计算机专业学生，性格开朗外向，喜欢结交新朋友。
他对编程充满热情，经常在开源社区活跃。说话风格轻松幽默，喜欢用emoji。
他有点完美主义，但不会过于焦虑。对新事物充满好奇，喜欢尝试新技术。
```

**persona_config字段（JSON）**：
```json
{
  "tags": ["学生", "程序员", "开源爱好者"],
  "interests": ["编程", "音乐", "旅行"],
  "speaking_style": {
    "formality": "casual",
    "humor_level": "high",
    "emoji_usage": "frequent"
  },
  "personality_scores": {
    "extraversion": 0.9,
    "openness": 0.8
  }
}
```

**优点**：
- 自然语言描述保留了表达力和LLM理解能力
- JSON元数据支持程序化查询和修改
- 可以根据需要扩展JSON字段，不影响自然语言描述
- 人类可读性强，AI也能理解

**使用场景**：
- LLM生成回复时：主要使用persona字段（自然语言）
- 程序化查询时：使用persona_config字段（例如：找到所有"幽默"的Agent）
- 程序化修改时：修改persona_config，然后让LLM重新生成persona描述

---

## 用户决策

✅ **用户采纳混合方案**

**决策理由**：
- 结合了三方方案的优点
- 灵活性和结构化兼顾
- 易于实现和扩展

---

## 下一步行动

1. 在数据库中实现agents表（包含persona和persona_config字段）
2. 设计persona生成工具（让LLM生成自然语言描述 + JSON元数据）
3. 实现persona注入逻辑（将persona字段注入到LLM prompt中）
4. 实现persona修改工具（程序化修改persona_config，然后重新生成persona描述）
5. 设计persona模板库（可选，用于快速生成常见人格类型）

---

## 关键决策点

- ✅ 采用混合方案（自然语言 + JSON元数据）
- ✅ persona字段存自然语言描述
- ✅ persona_config字段存结构化元数据
- ✅ LLM生成回复时主要使用persona字段
- ✅ 程序化查询和修改时使用persona_config字段
