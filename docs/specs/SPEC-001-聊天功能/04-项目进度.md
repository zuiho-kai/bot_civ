# 04-é¡¹ç›®è¿›åº¦

> ç»Ÿä¸€è¿›åº¦è·Ÿè¸ªï¼Œåˆå¹¶å‰åç«¯è¿›åº¦ã€‚å•ä¸€æ¥æºã€‚

---

## å½“å‰çŠ¶æ€

- **M1**: âœ… å…¨éƒ¨å®Œæˆï¼Œç«¯åˆ°ç«¯éªŒè¯é€šè¿‡
- **M2**: ğŸ“‹ å¾…è¯¦ç»†æ‹†åˆ†ï¼Œæœªå¼€å§‹
- **M3**: ğŸ“‹ è¿œæœŸï¼Œæœªå¼€å§‹

---

## M1 è¿›åº¦æ˜ç»†

### åç«¯

| ä»»åŠ¡ | å®Œæˆæ—¶é—´ | æ”¹åŠ¨æ–‡ä»¶ | éªŒè¯ |
|------|----------|----------|------|
| #1 Agent CRUD + WebSocket | 2026-02-14 | tables.py, schemas.py, agents.py, chat.py, config.py, main.py | 11 ä¸ªå†’çƒŸæµ‹è¯•é€šè¿‡ |
| #2 å”¤é†’å¼•æ“ | 2026-02-14 | wakeup_service.py | ä»£ç å°±ç»ª |
| #3 æ¨¡æ‹Ÿè§¦å‘å™¨ | 2026-02-14 | POST /api/dev/trigger + scripts/trigger.py | CLI æµ‹è¯•é€šè¿‡ |
| #5 LLM é›†æˆ | 2026-02-14 | agent_runner.py | Arcee Trinity via OpenRouter éªŒè¯é€šè¿‡ |

**åç«¯å…³é”®æ”¹åŠ¨**:
- Message æ–°å¢ sender_type / message_type / mentions å­—æ®µ
- Agent æ–°å¢ daily_free_quota / quota_used_today / quota_reset_date ç»æµå­—æ®µ
- Agent CRUD è¡¥å…¨ PUT/DELETEï¼Œname å”¯ä¸€æ€§ + å­—ç¬¦é›†æ ¡éªŒ
- WebSocket åè®®å‡çº§ï¼ˆæ–°æ¶ˆæ¯æ ¼å¼ + å‘åå…¼å®¹ï¼‰
- @æåŠè§£æï¼ˆparse_mentionsï¼‰
- ç³»ç»Ÿé€šçŸ¥ï¼ˆagent_online / agent_offlineï¼‰
- ä¿®å¤ N+1 æŸ¥è¯¢ï¼ˆJOIN åŠ è½½ï¼‰
- lifespan æ›¿ä»£ deprecated on_event
- å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ– Human Agent (id=0)

### å‰ç«¯

| ä»»åŠ¡ | å®Œæˆæ—¶é—´ | æ”¹åŠ¨æ–‡ä»¶ | éªŒè¯ |
|------|----------|----------|------|
| #4 èŠå¤©ç•Œé¢ + WebSocket | 2026-02-14 | ChatRoom, MessageList, MessageBubble, ChatInput, AgentSidebar, useWebSocket, types.ts, api.ts | 13 ä¸ªç»„ä»¶æµ‹è¯•é€šè¿‡ |
| #6 Agent ç®¡ç†é¡µé¢ | 2026-02-14 | AgentManager.tsx | åˆ—è¡¨ + åˆ›å»ºè¡¨å• |

**å‰ç«¯å…³é”®ç‰¹æ€§**:
- Discord é£æ ¼å››æ å¸ƒå±€ï¼ˆServer Rail / Channel Sidebar / Chat Area / Info Panelï¼‰
- Mock æ•°æ®å±‚ï¼ˆåç«¯ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§ï¼Œæˆ– `?mock` å¼ºåˆ¶å¯ç”¨ï¼‰
- WebSocket æ–­çº¿é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- æ¶ˆæ¯åˆ†ç»„ï¼ˆåŒä¸€å‘é€è€…è¿ç»­æ¶ˆæ¯æŠ˜å å¤´åƒï¼‰
- Avatar boxShadow è§†è§‰åˆ†ç¦»
- Model selector æ”¯æŒè‡ªå®šä¹‰æ¨¡å‹ï¼ˆinput + datalistï¼‰
- æš—è‰²ä¸»é¢˜

### é›†æˆ

| ä»»åŠ¡ | å®Œæˆæ—¶é—´ | éªŒè¯ |
|------|----------|------|
| #7 ç«¯åˆ°ç«¯è”è°ƒ | 2026-02-14 | Human â†’ @mention â†’ LLM reply â†’ broadcast å…¨é“¾è·¯é€šè¿‡ |

---

## æŠ€æœ¯å€ºåŠ¡

### åç«¯
- [ ] Agent CRUD åˆ†é¡µ
- [ ] WebSocket æ–­çº¿é‡è¿ / å¿ƒè·³æœºåˆ¶
- [ ] GET /api/messages since_id å¢é‡æ‹‰å–ï¼ˆPhase 2ï¼‰
- [ ] agent_typing ç³»ç»Ÿäº‹ä»¶ï¼ˆPhase 2ï¼‰

### å‰ç«¯
- [ ] @æåŠè‡ªåŠ¨è¡¥å…¨ï¼ˆChatInput å¢å¼ºï¼ŒPhase 2ï¼‰
- [ ] agent_typing äº‹ä»¶å±•ç¤ºï¼ˆPhase 2ï¼‰
- [ ] since_id å¢é‡æ‹‰å–æ¶ˆæ¯ï¼ˆPhase 2ï¼‰
- [ ] è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ¶ˆæ¯è¿‡å¤šæ—¶æ€§èƒ½ï¼‰
- [ ] æ¶ˆæ¯æœ¬åœ°ç¼“å­˜

---

## é‡åˆ°çš„é—®é¢˜

è¯¦è§ [é”™é¢˜æœ¬](../../runbooks/error-book.md)ï¼š
1. lifespan ä¸è§¦å‘
2. ç«¯å£å†²çª
3. Windows curl ç¼–ç 
