# 错题本 — 🧪 QA Lead

> 测试设计、测试执行相关的典型错误。

---

### QA-1 测试只覆盖正常流程

❌ 只测"发送消息成功"
✅ 覆盖正常流程 + 异常流程 + 边界条件（空消息、超长消息、并发发送）
> 异常和边界是 Bug 高发区。

### QA-2 测试用例没有明确预期结果

❌
```markdown
TC-001: 发送消息
步骤: 输入消息，点击发送
预期: 消息发送成功
```

✅
```markdown
TC-001: 发送消息
步骤: 输入"你好"，点击发送
预期:
  1. 消息出现在聊天列表，显示发送时间
  2. WebSocket 收到 broadcast 事件
  3. 数据库 messages 表新增一条记录
```
> 预期结果必须具体、可验证，不能用"成功"一词带过。

### QA-3 测试环境和开发环境混用

❌ 测试直接跑在开发数据库上，测试数据污染开发数据
✅ 测试用独立的 test.db，fixture 负责创建和清理
> 测试环境隔离，避免互相干扰。

### QA-4 Bug 报告缺少复现步骤

❌
```markdown
Bug: 消息发不出去
```

✅
```markdown
Bug: 消息发不出去
- 复现步骤: 1. 打开聊天页 2. 输入超过500字 3. 点击发送
- 实际结果: 页面无反应，控制台报 413
- 预期结果: 提示"消息过长"
- 环境: Chrome 120, localhost:5173
```
> 没有复现步骤的 Bug 报告 = 无效报告。

### QA-5 测试只覆盖单连接，不测并发写入

❌ 数据库相关测试只用单个连接顺序读写，所有用例都通过，上线后多个 async task 同时写入就死锁
✅ 技术选型有并发约束时，测试用例必须包含并发写入场景（至少 2-3 个 async task 同时写入）
> 隐含约束不会在单连接测试中暴露。QA 在设计测试时应主动查阅架构文档的**技术约束清单**，针对约束项设计测试用例。

**检查清单（设计数据库相关测试时）**:
1. [ ] 是否有并发写入测试？（多个 async task 同时 INSERT/UPDATE）
2. [ ] 是否测试了事务冲突场景？（两个事务同时修改同一行）
3. [ ] 是否验证了数据库配置生效？（如 BEGIN IMMEDIATE、WAL 模式）
4. [ ] 是否测试了 fire-and-forget 写入不丢数据？

**实际案例**（DEV-BUG-7，详见 COMMON-8）：单元测试只测了单连接读写全部通过，e2e 测试只验证 happy path。SQLite DEFERRED 死锁在多 async task 并发写入时才触发，测试阶段完全没覆盖。
