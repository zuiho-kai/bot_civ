# 常见错误案例合集

> 本文件包含两部分：跨角色的通用错误 + 各角色错题本索引。

---

## 角色错题本索引

| 角色 | 错题本 | 覆盖范围 |
|------|--------|---------|
| 💻 开发者 | [error-book-dev.md](error-book-dev.md) | 前后端协作、代码实施、环境踩坑 |
| 📋 项目经理 | [error-book-pm.md](error-book-pm.md) | 进度记录、里程碑同步、上下文管理 |
| 🏗️ 架构师 / ⚖️ 辩论者 | [error-book-debate.md](error-book-debate.md) | 辩论流程、方案设计、决策记录 |
| 🧪 QA Lead | [error-book-qa.md](error-book-qa.md) | 测试设计、测试执行、Bug 报告 |
| 📝 记录员 | [error-book-recorder.md](error-book-recorder.md) | 讨论落盘、索引维护、信息去重 |

---

## 通用错误（所有角色适用）

### COMMON-1 对话是临时的，文件是持久的

❌ 讨论完直接告诉用户结论，没有写文件
✅ 任何重要讨论/决策/进展，必须落盘到对应文件
> 对话丢了就没了，文件才是持久记忆。

### COMMON-2 多个文件记录同一信息

❌ 文档结构在 CLAUDE.md 写一遍，claude-progress.txt 又写一遍
✅ 只在一个地方维护，其他地方放链接
> 信息只有一个 source of truth，重复 = 不一致风险。

### COMMON-3 详细内容放在索引文件里

❌ discussions.md 里放完整的辩论过程（几百行）
✅ 索引文件只放表格/链接，详细内容在独立文件里
> 索引文件要轻，详细内容按需加载。

### COMMON-4 改了内容没更新索引

❌ 新建了文件，但 CLAUDE.md / discussions.md 等索引没加条目
✅ 新建文件的同时，更新所有相关索引
> 没索引 = 找不到 = 不存在。

### COMMON-5 角色越界操作

❌ 后端终端改前端文件、记录员做架构决策、PM 直接改代码
✅ 每个角色只做自己职责范围内的事，需要跨界时通知对应角色
> 职责分离是多 Agent 协作的基础。

### COMMON-6 跨模块语义假设不一致

❌ 模块A改变了核心概念的含义（如"Agent在线"从"有WebSocket连接"变成"服务端驱动"），但依赖该概念的模块B没有同步更新
✅ 当架构决策改变了某个概念的语义时，必须回溯所有依赖该概念的模块，更新其前提假设
> 典型案例：方案G改变了Agent存在方式，但唤醒服务的"在线"定义没跟着更新（DEV-BUG-5）。TDD中应明确列出跨模块依赖假设。

### COMMON-7 主 Agent 直接做低复杂度任务

❌ 索引同步、链接更新、进度记录等简单任务，主 Agent（Opus/Sonnet）亲自逐个文件读+改
✅ 派子 Agent 处理：`Task(model="haiku")` 做文档编辑/索引同步/链接更新/进度记录，`Task(model="sonnet")` 做需要理解上下文的简单修改
> 主 Agent 是调度器，不是执行器。格式化任务（添加索引、更新链接、记录进度）必须用 haiku 子 agent，省 token 省成本。参考 [模型选择策略](model-selection.md)。

**实际案例**（2026-02-14）：
- 用户要求添加 `eval-review.md` 到 SPEC-001 索引
- 主 Agent（Sonnet）直接用 Glob/Read/Edit 完成
- 应该做法：`Task(model="haiku", prompt="添加 eval-review.md 到 SPEC-001/README.md 索引")`
- 成本差异：Sonnet 处理简单文档编辑浪费约 3-5 倍成本

---

通用错误追加到本文件，前缀 `COMMON-`。
角色专属错误追加到对应角色的错题本，格式：

```markdown
### [角色前缀]-[编号] 简短标题

❌ 错误做法
✅ 正确做法
> 一句话解释为什么。
```

实际 Bug 踩坑：

```markdown
### [角色前缀]-BUG-[编号] 简短标题

- **场景**: 什么情况下触发
- **现象**: 看到了什么
- **原因**: 根因是什么
- **修复**: 怎么解决的
```
