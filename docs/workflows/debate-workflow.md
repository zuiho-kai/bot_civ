# 工作流 2：协作讨论流程（求同存异，融合方案）

## 核心理念

**目标**：不是"选出"合适方案，而是**讨论出**合适方案
- ✅ 互相吸收优点，融合设计
- ✅ 从多个维度同时考虑（性能+人类直觉+实现难度+可维护性）
- ✅ 求同存异，可以产出多个侧重点不同的方案
- ❌ 不是独立论证，而是协作完善

## 流程图

```
发起讨论（定义议题）
    ↓
📝 [记录员] 记录议题背景到 claude-progress.txt
    ↓
=== 第 1 轮：多角度初步方案 ===
并行启动 3 个 Task（子 Agent，不同角度）:
    ├── 专家 A: 从角度 1 提出初步方案（如性能优化）
    ├── 专家 B: 从角度 2 提出初步方案（如复杂度控制）
    └── 专家 C: 从角度 3 提出初步方案（如人类直觉）
    ↓
各专家输出（≤600字）:
    - 方案描述
    - 核心优势
    - 承认的不足之处
    - 想向其他专家请教的问题
    ↓
=== 第 2-3 轮：协作融合与互补 ===
并行启动 3 个 Task（协作模式）:
    - 专家 A: 吸收 B/C 的优点 → 改进自己的方案
    - 专家 B: 吸收 A/C 的优点 → 改进自己的方案
    - 专家 C: 吸收 A/B 的优点 → 改进自己的方案
    ↓
每轮输出（≤500字）:
    - 我吸收了哪些其他方案的优点
    - 我的方案如何改进
    - 我能帮助其他方案完善什么（技术细节、落地方案）
    - 是否与其他方案融合成新方案
    ↓
（重复 2-3 轮，直到方案趋于稳定）
    ↓
=== 第 4 轮：最终方案输出 ===
并行启动 3 个 Task:
    - 各专家输出最终方案（可以是融合后的统一方案，或侧重点不同的多个方案）
    - 明确标注：与其他方案的关系（融合/互补/独立）
    ↓
架构师汇总:
    - 整理最终方案（可能是 1 个融合方案，或 2-3 个互补方案）
    - 对比表：各方案的特色/侧重点/适用场景
    - 技术实现细节完整性检查
    ↓
呈现给用户:
    - 协作讨论摘要
    - 最终方案（含技术细节、落地路径）
    - 推荐理由（基于多维度考量）
    ↓
AskUserQuestion → 用户最终选择或提出补充需求
    ↓
📝 [记录员] 记录完整讨论过程 + 最终方案 + 用户决策
    ↓
进入实施
```

## 讨论规则

### 基本规则
- **最多 4 轮**：第 1 轮多角度方案 + 第 2-3 轮协作融合 + 第 4 轮最终输出
- **提前终止**：如果第 2 轮后方案已融合稳定，可跳过剩余轮次
- **协作原则**：互相吸收优点，互相帮助完善，求同存异
- **多维度考量**：同时考虑性能、人类直觉、实现难度、可维护性、后续扩展性
- **方案融合**：鼓励融合多个方案优点，产出统一方案或互补的多个方案
- **落地完整性**：方案必须包含技术细节、实现路径、代码示例，不能只有哲学或抽象设计
- **用户最终决策权**：讨论结果仅供参考，用户可以选择任何方案、提出补充需求或要求重新讨论

### 重要约束
- **⚠️ 禁止打包讨论**：不同维度的决策（如前端框架 vs 后端框架）必须拆开独立讨论，每个议题单独走讨论流程，单独记录结果。绝不能把多个独立问题捆绑成一个讨论。
- **⚠️ 讨论记录必须可见**：每轮讨论的详细内容（各方观点、建议、回应）必须完整记录到 `docs/discussions.md`，不能只记录最终结果。`claude-progress.txt` 只记决策摘要。

## 触发条件

以下情况**必须**发起协作讨论：
1. 架构层面的技术选型（框架、语言、数据库等）
2. 系统设计模式选择
3. 影响面超过 3 个文件的重构方案
4. 新功能的实现策略（存在 ≥2 种可行方案时）
5. 用户主动要求讨论

以下情况**不需要**讨论（直接执行）：
- Bug 修复（原因明确）
- 单文件的小改动
- 文档更新
- 用户给出了明确指示

## 各轮输出规范

### 第 1 轮：各自视角的初步方案（≤600字）
- 方案描述（从自己的专业视角出发）
- 核心优势（≥3 点）
- 自己方案的已知不足（诚实承认）
- 想向其他专家请教的问题

### 第 2-3 轮：协作融合（≤500字）
- 从其他专家方案中吸收了什么
- 自己的方案如何改进
- 对其他专家方案的建设性建议（带替代方案的质疑，不是纯批评）
- 当前共识点 + 仍有分歧的点

### 第 4 轮：最终方案（≤400字）
- 最终方案描述（可以是融合后的统一方案，或标注差异的互补方案）
- 与其他专家方案的关系（融合/互补/独立）
- 落地路径和关键实现细节

### 架构师汇总输出
- 讨论过程中的关键共识点
- 最终方案（1 个融合方案，或多个互补方案的对比表）
- 各方案的适用场景和侧重点
- 推荐方案（基于多维度综合考量）
