# 工作流 2：协作讨论流程（求同存异，融合方案）

## 核心理念

**目标**：不是"选出"合适方案，而是**讨论出**合适方案
- ✅ 互相吸收优点，融合设计
- ✅ 从多个维度同时考虑（性能+人类直觉+实现难度+可维护性）
- ✅ 求同存异，可以产出多个侧重点不同的方案
- ❌ 不是独立论证，而是协作完善

## 流程图

```
发起讨论（定义议题）
    ↓
📝 [记录员] 记录议题背景到 claude-progress.txt
    ↓
=== 第 1 轮：多角度初步方案 ===
并行启动 5 个 Task（子 Agent，不同角度）:
    ├── 架构师: 架构层面评估（扩展性、技术债、依赖管理）
    ├── 人类替身 PM: 用户偏好对齐（查知识库，代表用户立场）
    ├── 讨论专家: 多维度分析（成本效益、风险、被忽略的方案）
    ├── QA Lead: 质量与测试视角（可测试性、回归风险、验证成本）
    └── Tech Lead: 技术可行性（实现难度、团队能力、技术趋势）
    ↓
各专家输出（≤600字）:
    - 方案描述
    - 核心优势
    - 承认的不足之处
    - 想向其他专家请教的问题
    ↓
=== 第 2-3 轮：协作融合与互补 ===
并行启动 5 个 Task（协作模式）:
    - 各专家: 吸收其他 4 位的优点 → 改进自己的方案
    ↓
每轮输出（≤500字）:
    - 我吸收了哪些其他方案的优点
    - 我的方案如何改进
    - 我能帮助其他方案完善什么（技术细节、落地方案）
    - 是否与其他方案融合成新方案
    ↓
（重复 2-3 轮，直到方案趋于稳定）
    ↓
=== 第 4 轮：最终方案输出 ===
并行启动 5 个 Task:
    - 各专家输出最终方案（可以是融合后的统一方案，或侧重点不同的多个方案）
    - 明确标注：与其他方案的关系（融合/互补/独立）
    ↓
架构师汇总:
    - 整理最终方案（可能是 1 个融合方案，或 2-3 个互补方案）
    - 对比表：各方案的特色/侧重点/适用场景
    - 技术实现细节完整性检查
    ↓
呈现给用户:
    - 协作讨论摘要
    - 最终方案（含技术细节、落地路径）
    - 推荐理由（基于多维度考量）
    ↓
AskUserQuestion → 用户最终选择或提出补充需求
    ↓
📝 [记录员] 记录完整讨论过程 + 最终方案 + 用户决策
    ↓
进入实施
```

## 讨论规则

### 基本规则
- **最多 4 轮**：第 1 轮多角度方案 + 第 2-3 轮协作融合 + 第 4 轮最终输出
- **提前终止**：如果第 2 轮后方案已融合稳定，可跳过剩余轮次
- **协作原则**：互相吸收优点，互相帮助完善，求同存异
- **多维度考量**：同时考虑性能、人类直觉、实现难度、可维护性、后续扩展性
- **方案融合**：鼓励融合多个方案优点，产出统一方案或互补的多个方案
- **落地完整性**：方案必须包含技术细节、实现路径、代码示例，不能只有哲学或抽象设计
- **用户最终决策权**：讨论结果仅供参考，用户可以选择任何方案、提出补充需求或要求重新讨论

### 重要约束
- **⚠️ 禁止打包讨论**：不同维度的决策（如前端框架 vs 后端框架）必须拆开独立讨论，每个议题单独走讨论流程，单独记录结果。绝不能把多个独立问题捆绑成一个讨论。
- **⚠️ 讨论记录必须可见**：每轮讨论的详细内容（各方观点、建议、回应）必须完整记录到 `docs/discussions.md`，不能只记录最终结果。`claude-progress.txt` 只记决策摘要。
- **⚠️ 禁止预设方案选择题**：第 1 轮各专家可以自由提出任何方案（包括全新方案），不能只在主持人预设的 A/B/C 里选。讨论的目标是融合出新方案，不是投票选现有方案。
- **⚠️ 问题必须被回应**：每轮中专家提出的问题（"想向其他专家请教的问题"），在下一轮必须有至少一位专家正面回应。汇总时检查：如果有问题无人回应，标记为"未解决问题"并在最终方案中注明。
- **⚠️ 禁止用"先跑再说"回避技术问题**：当某位专家提出具体的技术疑虑（如"批量调用是否导致行为趋同"），其他专家必须给出技术层面的分析或实验方案，不能仅用"MVP 先上再看"搪塞。可以建议分阶段验证，但必须说明验证标准和回退方案。
- **⚠️ 必须走正式流程**：任何需要讨论的议题，必须按本文件定义的轮次和规则执行，不能自行发明临时"研讨会"或简化流程。
- **⚠️ 角色组成规则**：
  - 固定席位（必选）：架构师 + 人类替身 PM + Tech Lead
  - 灵活席位（按议题选配）：讨论专家和 QA Lead 可替换为其他更合适的角色（如成本分析师、UX 专家等）。设计层讨论不强制 QA，开发层讨论才需要 QA。讨论专家是泛用席位，可以由任何领域专家担任。
  - 总人数保持 5 个，确保多维度覆盖。

## 触发条件

以下情况**必须**发起协作讨论：
1. 架构层面的技术选型（框架、语言、数据库等）
2. 系统设计模式选择
3. 影响面超过 3 个文件的重构方案
4. 新功能的实现策略（存在 ≥2 种可行方案时）
5. 用户主动要求讨论

以下情况**不需要**讨论（直接执行）：
- Bug 修复（原因明确）
- 单文件的小改动
- 文档更新
- 用户给出了明确指示

## 各轮输出规范

### 第 1 轮：各自视角的初步方案（≤600字）
- 方案描述（从自己的专业视角出发）
- 核心优势（≥3 点）
- 自己方案的已知不足（诚实承认）
- 想向其他专家请教的问题

### 第 2-3 轮：协作融合（≤500字）
- 从其他专家方案中吸收了什么
- 自己的方案如何改进
- 对其他专家方案的建设性建议（带替代方案的质疑，不是纯批评）
- 当前共识点 + 仍有分歧的点

### 第 4 轮：最终方案（≤400字）
- 最终方案描述（可以是融合后的统一方案，或标注差异的互补方案）
- 与其他专家方案的关系（融合/互补/独立）
- 落地路径和关键实现细节

### 架构师汇总输出
- 讨论过程中的关键共识点
- 最终方案（1 个融合方案，或多个互补方案的对比表）
- 各方案的适用场景和侧重点
- 推荐方案（基于多维度综合考量）
