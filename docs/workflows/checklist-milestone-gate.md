# 里程碑门控规则

每个新里程碑（M1, M2, M3...）必须按顺序完成三层文档，缺一不可，不允许跳步：

| 阶段 | 文档 | 只写什么 | 不写什么 | 门控 |
|------|------|----------|----------|------|
| IR（需求原型） | `01-需求原型.md` 对应章节 | 用户故事、功能点、验收标准、非功能需求 | 技术方案、文件路径、伪代码 | 用户确认后才能进入 SR |
| SR（需求拆分） | `02-需求拆分.md` 对应章节 | 里程碑目标、任务 ID/名称/依赖/状态、验收标准、关键路径 | 具体函数签名、seed 数据、实现伪代码 | 用户确认后才能进入 AR |
| AR（技术设计） | `TDD-M*-xxx.md` | 架构图、接口定义、伪代码、数据流、文件清单、测试计划 | 产品需求重复、用户故事 | 用户确认后才能开始编码 |

## 强制检查点

- 开始新里程碑前，确认上一个里程碑的 IR/SR/AR 均已完成或标记为"远期"
- 讨论记录（`docs/discussions/`）不等于正式文档，讨论中的设计决策必须提炼回 SPEC 对应层级
- 发现跳步时立即停下，补齐缺失层级，不要带着缺口继续推进

## 新功能/里程碑完整流程

1. 先走 IR → SR → AR 门控流程，每层用户确认后再进入下一层
2. AR 完成后按 `docs/workflows/development-workflow.md` 继续：
   - 阶段 3：正向串讲（Developer → QA Lead）— 复杂功能必须，简单修改可跳过
   - 阶段 4：反向串讲（QA Lead → Developer）— 与正向串讲同步
   - 阶段 5：测试用例设计（QA Lead 输出 TEST-XXX.md）
   - **阶段 6 开发实施**：以上全部完成后才能开始写代码
