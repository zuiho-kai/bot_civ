# 项目进展

> 细节进展 → `server/progress.md` / `web/progress.md`
> 历史变更 → `docs/changelog.md`

## 当前状态

- **阶段**: M5.2 完成（交易市场 — 挂单/接单/撤单，ST 16/16 全绿）
- **技术栈**: FastAPI + WebSocket | React + Vite | SQLite + NumPy + 硅基流动 Embedding API
- **仓库**: https://github.com/zuiho-kai/bot_civ
- **测试**: UT 211/211 全绿 + M5.2 ST 16/16 全绿

## 最近活动

### 2026-02-20
- M5.2 交易市场完成：ST 16/16 全绿 + pytest 211/211 全绿
  - 后端：`market_service.py`（挂单/接单/撤单）、`city.py`（5 个 REST 路由）、`tool_registry.py`（3 个交易工具）
  - 前端：`TradePage.tsx`（交易市场 UI）、`types.ts`/`api.ts`（类型+API）
  - Code Review 2 轮（后端+前端），P0/P1 归零
  - 修复：`await db.commit()` 补全、`_map_error_status` 覆盖"只能"、AgentUpdate 加 stamina
  - 错题本：DEV-27 二次复犯（错误映射不全）、DEV-30 新增（ST 环境假设脆弱）

### 2026-02-19
- M5.1 资源转赠 + Tool Use 完成：ST 8/8 全绿
  - 后端：`tool_registry.py`（Tool Use 框架）、`agent_runner.py`（LLM tool_call 循环）、`autonomy_service.py`（Agent 自主转赠）、`city_service.py`（转赠事件广播）
  - 前端：`TradePage.tsx`（交易面板）、React Router 引入、API 包装、类型扩展
  - ST-1~4: 转赠成功/资源不足/WS 广播/数量校验
  - ST-5: Tool Use 端到端（真实 LLM，Agent 回复确认）
  - 修复：e2e 脚本 Agent 模型从 gpt-4o-mini 改为 stepfun/step-3.5-flash（MODEL_REGISTRY 匹配）

### 2026-02-18
- M5 记忆系统 + 城市经济全功能实现 + 真实 E2E 验证
- M4 Agent 自主行为 — 后端引擎 + 前端展示 + E2E 验证
  - 修复：模型切换 + prompt 精简 + reasoning fallback
  - Gap Closure: 9 E2E + 10 单元测试

### 2026-02-17
- M3 城市经济闭环 — 工作/商店/前端 + Code Review 修复
- M3 体验问题修复 5 项（悬赏表单 UI、Agent dropdown 搜索、颜色主题变量化等）

### 2026-02-16
- M2 Phase 6 完成：E2E 端到端验证 14/14 全绿
  - REST 场景 8/8 + LLM 场景 6/6
- M2 Phase 3-5 完成：记忆注入、经济系统、悬赏、批量唤醒、前端 UI

## 里程碑

- M1 ✅: Agent CRUD + WebSocket 聊天 + 唤醒引擎 + LLM 集成
- M1.5 ✅: OpenClaw Plugin（TypeScript，openclaw-plugin/ 子目录）
- M2 ✅: 记忆与经济系统（Phase 1-6，14/14 E2E 全绿）
- M3 ✅: 城市经济闭环 + 体验修复
- M4 ✅: Agent 自主行为（E2E 验证通过）
- M5 ✅: 记忆系统 + 城市经济（全功能 + E2E 验证）
- M5.1 ✅: 资源转赠 + Tool Use（ST 8/8 全绿）
- M5.2 待定: 交易市场（挂单/接单/撤单）
- M6 待定: Agent CLI 运行时（持久进程 + 上网 + 任意工具）

## 遗留

- [ ] CSS 硬编码清理 + stylelint 规则 + 设计 token 规划文档
- [ ] Cat Cafe 风格主题（浅绿/米色暖色调、圆角卡片）
- [ ] Radix UI 按需引入（复杂交互时试点）
- [ ] Tailwind CSS 评估（组件数涨到 50+ 时重新评估）
- [ ] SSE 改造（等 Redis Pub/Sub 一起做）
